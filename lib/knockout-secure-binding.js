/*! knockout-secure-binding - v0.4.4 - 2014-02-20
 *  https://github.com/brianmhunt/knockout-secure-binding
 *  Copyright (c) 2013 - 2014 Brian M Hunt; License: MIT */
!function(t){"function"==typeof define&&define.amd?define(["knockout","exports"],t):t(ko)}(function(t,e,n){function r(t){return t instanceof c||t instanceof a?t.get_value():t}function i(t){return t>="A"&&"Z">=t||t>="a"&&"z">=t||t>="0"&&9>=t||"_"===t||"$"===t}function o(e){new t.bindingProvider;e=e||{},this.attribute=e.attribute||"data-sbind",this.noVirtualElements=e.noVirtualElements||!1,this.globals=e.globals||{},this.bindings=e.bindings||t.bindingHandlers}function s(e){t.utils.extend(this.bindings,e)}function h(t){var e;return t.nodeType===t.ELEMENT_NODE?t.getAttribute(this.attribute):t.nodeType===t.COMMENT_NODE?this.noVirtualElements?!1:(e=(""+t.nodeValue||t.text).trim(),0===e.indexOf("ko ")):void 0}function u(t,e){var n,r={};return t.nodeType===t.ELEMENT_NODE?n=t.getAttribute(this.attribute):t.nodeType===t.COMMENT_NODE&&(n=t.nodeValue.replace("ko ","")),n&&(r=new f(t,e,this.globals).parse(n)),r}var c,a,f,p;return c=function(){function t(t,e,n){this.token=e,this.dereferences=n,this.parser=t}return t.prototype.lookup_value=function(t){var e=this.token,n=this.parser,i=n.context,o=i.$data||{},s=n.globals||{};if(t)return r(t)[e];switch(e){case"$element":return n.node;case"$context":return i;case"$data":return o}return o[e]||i[e]||s[e]},t.prototype.dereference=function(t){var e,n,i,o,s=this.dereferences||[],h=this.parser,u=h.context||{},c=u.$data||{},a={$context:u,$data:c,globals:h.globals||{},$element:h.node};for(i=0,o=s.length;o>i;++i)e=s[i],e===!0?(t=t.call(n||a),n=t):(n=t,t=t[r(e)]);return t},t.prototype.get_value=function(t){return this.dereference(this.lookup_value(t))},t.prototype.set_value=function(t){var e,n,i,o=this.parser,s=o.context,h=s.$data||{},u=o.globals||{},c=this.dereferences||[],a=this.token;if(Object.hasOwnProperty.call(h,a))i=h;else if(Object.hasOwnProperty.call(s,a))i=s;else{if(!Object.hasOwnProperty.call(u,a))throw new Error("Identifier::set_value -- The property '"+a+"' does not exist on the $data, $context, or globals.");i=u}for(n=c.length,0===n&&(i[a]=t),i=i[a],e=0;n-1>e;++e)a=c[e],i=a===!0?i():i[r(a)];if(c[e]===!0)throw new Error("Cannot assign a value to a function.");i[r(c[e])]=t},t}(),p=function(){function e(t,e,n){this.lhs=t,this.op=e,this.rhs=n}var n={"!":function(t,e){return!e},"!!":function(t,e){return!!e},"*":function(t,e){return t*e},"/":function(t,e){return t/e},"%":function(t,e){return t%e},"+":function(t,e){return t+e},"-":function(t,e){return t-e},"<":function(t,e){return e>t},"<=":function(t,e){return e>=t},">":function(t,e){return t>e},">=":function(t,e){return t>=e},"==":function(t,e){return t===e},"!=":function(t,e){return t!==e},"===":function(t,e){return t===e},"!==":function(t,e){return t!==e},"&":function(t,e){return t&e},"^":function(t,e){return t^e},"|":function(t,e){return t|e},"&&":function(t,e){return t&&e},"||":function(t,e){return t||e}};return n["!"].precedence=4,n["!!"].precedence=4,n["*"].precedence=5,n["/"].precedence=5,n["%"].precedence=5,n["+"].precedence=6,n["-"].precedence=6,n["<"].precedence=8,n["<="].precedence=8,n[">"].precedence=8,n[">="].precedence=8,n["=="].precedence=9,n["!="].precedence=9,n["==="].precedence=9,n["!=="].precedence=9,n["&"].precedence=10,n["^"].precedence=11,n["|"].precedence=12,n["&&"].precedence=13,n["||"].precedence=14,e.operators=n,e.prototype.get_leaf_value=function(n,r){if("function"==typeof n)return t.unwrap(n());if("object"!=typeof n)return r?r[n]:n;if(n instanceof c||n instanceof a)return t.unwrap(n.get_value(r));if(n instanceof e)return n.get_node_value(r);throw new Error("Invalid type of leaf node: "+n)},e.prototype.get_node_value=function(){return this.op(this.get_leaf_value(this.lhs),this.get_leaf_value(this.rhs))},e}(),a=function(){function t(t){this.nodes=t,this.root=this.build_tree(t)}return t.operators=p.operators,t.Node=p,t.prototype.build_tree=function(t){var e,n,r,i;for(n=e=new p(t.shift(),t.shift(),t.shift());t&&(r=t.shift(),i=t.shift(),r);)r.precedence>e.op.precedence?(e=new p(e,r,i),n=e):(n.rhs=new p(n.rhs,r,i),n=n.rhs);return e},t.prototype.get_value=function(){return this.root||(this.root=this.build_tree(this.nodes)),this.root.get_node_value()},t}(),f=function(){function e(t,e,n){this.node=t,this.context=e,this.globals=n||{}}var r={"'":"'",'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},o=a.operators;return e.Expression=a,e.Identifier=c,e.Node=p,e.prototype.white=function(){for(var t=this.ch;t&&" ">=t;)t=this.next();return t},e.prototype.next=function(t){return t&&t!==this.ch&&this.error("Expected '"+t+"' but got '"+this.ch+"'"),this.ch=this.text.charAt(this.at),this.at+=1,this.ch},e.prototype.error=function(t){throw{name:"SyntaxError",message:t,at:this.at,text:this.text}},e.prototype.name=function(){var t="";for(this.white(),ch=this.ch;ch;){if(":"===ch||" ">=ch)return t;t+=ch,ch=this.next()}return t},e.prototype.number=function(){var t,e="",n=this.ch;for("-"===n&&(e="-",n=this.next("-"));n>="0"&&"9">=n;)e+=n,n=this.next();if("."===n)for(e+=".",n=this.next();n&&n>="0"&&"9">=n;)e+=n,n=this.next();if("e"===n||"E"===n)for(e+=n,n=this.next(),("-"===n||"+"===n)&&(e+=n,n=this.next());n>="0"&&"9">=n;)e+=n,n=this.next();return t=+e,isFinite(t)?t:void error("Bad number")},e.prototype.object_add_value=function(t,e,n){n instanceof c||n instanceof a?Object.defineProperty(t,e,{get:function(){return n.get_value()},enumerable:!0}):t[e]=n},e.prototype.object=function(){var t,e={},n=this.ch;if("{"===n){if(this.next("{"),n=this.white(),"}"===n)return n=this.next("}"),e;for(;n;){if(t='"'===n||"'"===n?this.string():this.name(),this.white(),n=this.next(":"),Object.hasOwnProperty.call(e,t)&&this.error('Duplicate key "'+t+'"'),this.object_add_value(e,t,this.expression()),n=this.white(),"}"===n)return n=this.next("}"),e;this.next(","),n=this.white()}}this.error("Bad object")},e.prototype.read_string=function(t){for(var e,n,i,o="",s=this.next();s;){if(s===t)return s=this.next(),o;if("\\"===s)if(s=this.next(),"u"===s){for(i=0,n=0;4>n&&(e=parseInt(s=this.next(),16),isFinite(e));n+=1)i=16*i+e;o+=String.fromCharCode(i)}else{if("string"!=typeof r[s])break;o+=r[s]}else o+=s;s=this.next()}this.error("Bad string")},e.prototype.string=function(){var t=this.ch;return'"'===t?this.read_string('"'):"'"===t?this.read_string("'"):void this.error("Bad string")},e.prototype.array=function(){var t=[],e=this.ch;if("["===e){if(e=this.next("["),this.white(),"]"===e)return e=this.next("]"),t;for(;e;){if(t.push(this.expression()),e=this.white(),"]"===e)return e=this.next("]"),t;this.next(","),e=this.white()}}this.error("Bad array")},e.prototype.value=function(){var t;switch(this.white(),t=this.ch){case"{":return this.object();case"[":return this.array();case'"':case"'":return this.string();case"-":return this.number();default:return t>="0"&&"9">=t?this.number():this.identifier()}},e.prototype.operator=function(){for(var t,e="",n=this.white();n&&!(i(n)||" ">=n||""===n||'"'===n||"'"===n||"{"===n||"["===n||"("===n);)e+=n,n=this.next();return""!==e&&(t=o[e],t||this.error("Bad operator: '"+e+"'.")),t},e.prototype.expression=function(){for(var t,e=[],r=this.white();r&&(op=this.operator(),op&&(e.push(n),e.push(op)),"("===r?(this.next(),e.push(this.expression()),this.next(")")):(t=this.value(),e.push(t)),r=this.white(),":"!==r&&"}"!==r&&","!==r&&"]"!==r&&")"!==r&&""!==r);)op=this.operator(),op&&e.push(op),r=this.white();return 0===e.length?n:1===e.length?e[0]:new a(e)},e.prototype.dereference=function(){for(var t,e=this.white();e;){if("("===e)return this.next("("),this.white(),this.next(")"),!0;if("["===e)return this.next("["),t=this.expression(),this.white(),this.next("]"),t;if("."===e){for(t="",this.next("."),e=this.white();e&&i(e);)t+=e,e=this.next();return t}break}},e.prototype.identifier=function(){var t,e,r="",o=[];for(t=this.white();t&&i(t);)r+=t,t=this.next();switch(r){case"true":return!0;case"false":return!1;case"null":return null;case"undefined":return void 0}for(;t&&(e=this.dereference(),e!==n);)o.push(e);return new c(this,r,o)},e.prototype.bindings=function(){for(var t,e={},n=this.ch;n;)t=this.name(),this.white(),n=this.next(":"),e[t]=this.expression(),this.white(),n=this.ch?this.next(","):"";return e},e.prototype.convert_to_accessors=function(e){var n={};return t.utils.objectForEach(e,function(r,i){i instanceof c?(e[r]=function(){return i.get_value()},t.expressionRewriting._twoWayBindings[r]&&(n[r]=function(t){i.set_value(t)})):i instanceof a?e[r]=function(){return i.get_value()}:"function"!=typeof i&&(e[r]=function(){return i})}),Object.keys(n).length>0&&(e._ko_property_writers=function(){return n}),e},e.prototype.parse=function(t){return this.text=t,this.at=0,this.ch=" ",result=this.bindings(),this.white(),this.ch&&this.error("Syntax Error"),this.convert_to_accessors(result)},e}(),t.utils.extend(o.prototype,{registerBindings:s,nodeHasBindings:h,getBindingAccessors:u,Parser:f}),e||(t.secureBindingsProvider=o),o});